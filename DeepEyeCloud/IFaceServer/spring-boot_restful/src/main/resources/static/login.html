<!DOCTYPE html>
<html>
<head>
<title>Swagger UI</title>
<link rel="icon" type="image/png" href="images/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="images/favicon-16x16.png" sizes="16x16" />
<link href='css/typography.css' media='screen' rel='stylesheet' type='text/css' />
<link href='css/reset.css' media='screen' rel='stylesheet' type='text/css' />
<link href='css/screen.css' media='screen' rel='stylesheet' type='text/css' />
<link href='css/reset.css' media='print' rel='stylesheet' type='text/css' />
<link href='css/print.css' media='print' rel='stylesheet' type='text/css' />
<script src='lib/jquery-1.8.0.min.js' type='text/javascript'></script>
<script src='lib/jquery.slideto.min.js' type='text/javascript'></script>
<script src='lib/jquery.wiggle.min.js' type='text/javascript'></script>
<script src='lib/jquery.ba-bbq.min.js' type='text/javascript'></script>
<script src='lib/handlebars-2.0.0.js' type='text/javascript'></script>
<script src='lib/underscore-min.js' type='text/javascript'></script>
<script src='lib/backbone-min.js' type='text/javascript'></script>
<script src='swagger-ui.js' type='text/javascript'></script>
<script src='lib/highlight.7.3.pack.js' type='text/javascript'></script>
<script src='lib/marked.js' type='text/javascript'></script>
<script src='lib/swagger-oauth.js' type='text/javascript'></script>

<script type="text/javascript">
  $(function(){  
	var host = 'http://'+window.location.host;
	
    var username=document.getElementById('username');
    var password=document.getElementById('password');    

    function setToken(data){
    	  console.log("refresh_token success response:",data);  
    	 
    	  window.localStorage.setItem('access_token',data.access_token);
    	  window.localStorage.setItem('refresh_token',data.refresh_token);
    	  window.localStorage.setItem('expires_in',data.expires_in*1000+new Date().getTime()); 
    	}

    $(document).keydown(function(e){
        if(e.keyCode == 13) {
            $('#login').click();
        }
    });
    $('#login').click(function(){ 
        var requestData={
            "password" :  $('input[name=password]').val(),
            "username": $('input[name=username]').val(),
            "grant_type":"password",
            "scope":"read write",
            "client_secret":"123456",
            "client_id":"clientapp"
        };
        // console.info("login requestData",requestData);
        var url = host + '/api/';
        $.ajax({
            type:"POST",
            url: url+'oauth/token',
            dataType: 'json',
            data: requestData,
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Authorization", "Basic " + btoa("clientapp:123456"));
            },
            success: function(res) {
                console.info("login success response:",res);
                var timestamp=new Date().getTime();
                console.info("timestamp",timestamp);
               
                window.localStorage.setItem('access',JSON.stringify(res));
                setToken(res);
               
                window.location.href = host + "/api/static/index.html";
            },
            error:function(error){
                $('.passError').html('账号或密码输入错误!');
                setTimeout(function(){
                    $('.passError').html('');                    
                },2500);
            }
        });
    });

});
</script>
</head>
<style type="text/css">
.inputWrap {
	margin: 20px 0px;
    position: relative;
    color: #a8a8a8;
    text-align: center;
    top: 50px;
   
}

.inputWrap .item {
	margin-top: 5px;
}

.inputWrap .item .input {
	width: 300px;
	/*        height: 50px;*/
	font-size: 16px;
	padding: 12px;
	text-align: center;
	font-family: Microsoft Yahei;
	border: 1px solid #e5e5e5;
}

.inputWrap .item .btn {
	width: 327px;
	height: 48px;
	font-size: 16px;
	text-align: center;
	font-family: Microsoft Yahei;
	border: 1px solid #e5e5e5;
	line-height: 48px;
	color: #fff;
	cursor: pointer;
	background: #759DCE;
	position: relative;
	 left: 37%;
}

.inputWrap .item .btn:hover {
	background: #5581BE;
}
</style>
<body class="swagger-section">
	<div id='header'>
		<div class="swagger-ui-wrap">
			<a id="logo" href="http://swagger.io">swagger</a>

		</div>
	</div>
	<div class="container">

		
		  <div class='inputWrap'>
           <div class="item">
                <input  class='input' name="username" id='username' placeholder='请输入您的账号'/>
                <label class="error"></label>
            </div>
            <div class="item">
                <input  type='password' class='input' name="password" id='password' placeholder='请输入您的密码'/>
                <label class="error passError"></label>
            </div>
                   
            <div class="item">
            	<div class='btn' id='login'>登录</div>
               
            </div>            
        </div>

	</div>
	<!-- 
<div id="message-bar" class="swagger-ui-wrap">&nbsp;</div>
<div id="swagger-ui-container" class="swagger-ui-wrap"></div> -->
</body>
</html>
